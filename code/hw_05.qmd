---
title: "Homework 05"
author: "Adam Guerra"
format: html
editor: visual
date: 05/30/2023
html: 
  toc: TRUE
  toc-location: left
  code-fold: true
  theme: sandstone
execute: 
  message: false
  warning: false
---

```{r, include = FALSE, messgae = FALSE}
#load in packages
library(tidyverse)
library(car)
library(sqldf)
library(janitor)
library(ggthemes)
library(naniar)
library(performance)
library(broom)
library(ggeffects)
library(flextable)
library(naniar)
library(corrplot)
library(AICcmodavg)
library(GGally)
library(here)

#load in data
plant <- read_csv(here("data/sarracenia.csv")) |> 
        clean_names()

#subset desired columns
plant_clean <- plant |> 
               select(totmass, species, feedlevel, sla, 
                      chlorophyll, amass, num_lvs, num_phylls)
```

## Introduction

Sarracenia is a genus of carnivorous plants typically found on the eastern seaboard of the United States. Within our data there are ten different species.

## Methods

#### Protocols

"Two plants of each Sarracenia species were assigned to one of six feeding levels in a regression design ranging from 0 - 0.25g of finely ground wasps per feeding (for small species), 0 - 0.5g (for species of intermediate sizes), and 0 - 1.0g (for large species); N equals120 plants total. Aboveground size and Amass were measured prior to commencing treatments. Plants were fed once/week for 7 weeks." (Ellison).

#### Organization

The data is organized into columns that are characteristics, with each row being a an individual plant with its corresponding observations. There are 120 records and 32 variables in CSV format. 11 of the columns were calculated, while the other 21 were measurements.

#### Missing Data

```{r}
#visualize missing observations
gg_miss_var(plant_clean) +
  labs(title = "Missing Values in the Dataset") +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0),
        plot.caption.position = "plot")
```

###### Figure 1: There are a high number of mising values in the chlorophyll content and mass-based light-saturated photosyntehtic rate of youngest leaf columns. There are also quite a few values missing from the specific leaf area of the youngest fulley expanded leaf column.

If chlorophyll content is missing, the amass column likely cannot be calculated. This could be the reason that each of those columns have the same number of missing N/A. Although it could also be that those specific plants did not meet the requirements to take the measurement in other categories as well within the full data set.

#### Subset NAs

```{r}
#drop NAs
plant_sub <- plant_clean |> 
             drop_na(sla, chlorophyll, num_phylls, amass, num_lvs)
```

#### Correlation

```{r}
#calculate phearsons
plant_corr <- plant_sub |> 
              select(3:8) |> 
              cor(method = "pearson")

#visualize pearsons correlation 
corrplot(plant_corr, method = "ellipse", addCoef.col = "black")
```

###### Figure 2: This graph shows the correlations between the different variables that we are interested in using as predictors for total mass. For our data set the highest correlation is 0.32 and the lowest is 0. 

In this situation, I believe that it is safe to assume there is no colinearity between the variables. Although I will continue to monitor how the higher correlated variables affect different models as I run the regressions.

#### Relationships Between Variables

```{r, message = FALSE}
#create visualization of relationships
plant_sub |> 
  select(2:8) |> 
  ggpairs()
```

###### Figure 3: Shows figures of each variable plotted against one another to visualize relationships. Also contains correlation coefficients that are shown in figure 2.

Based on the results from figure 3, there do not appear to be any strong relationships between the possible predictor variables. There would be a clear positive or negative trend with points forming a line if there was strong correlation.

#### Create Null and Full Model

```{r}
#create null model
null <- lm(totmass ~ 1, data = plant_sub)

#create full model
full <- lm(totmass ~ species + feedlevel + sla + chlorophyll + 
             amass + num_lvs + num_phylls, data = plant_sub)
```

The null model in this and all cases is the response variable against a one slope line. For our full model we will be looking at all the possible predictor variables combined into one model. This may seem like the best model now; however, it is also the most complex.

#### Diagnostics

```{r}
#full model diagnostics 
par(mfrow = c(2,2))
plot(full)

#check normality
check_normality(full)

#check variability
check_heteroscedasticity(full)

```

Created standard plots for checking assumptions as well as using Shapiro-Wilks and Breusch-Pagen tests. After visually and statistically checking the assumptions, the full model did not meet all assumptions.

```{r}
#perform log transformation
null_log <- lm(log(totmass) ~ 1, data = plant_sub)
full_log <- lm(log(totmass) ~ species + feedlevel + sla + chlorophyll + 
             amass + num_lvs + num_phylls, data = plant_sub)

#check assumptions of transformed full model
par(mfrow = c(2,2))
plot(full_log)

check_normality(full_log)
check_heteroscedasticity(full_log)
```

After performing the log transformation, I generated the standard plots to visually check assumptions for the new transformed model. Then I ran the same statistical tests used on the transformed model, which this new version passed.

#### Evaluate Multicollinearity

```{r}
#run VIF
car::vif(full_log)
```

Using generalized variance inflation factor, I determined that none of the variables displayed concern for collinearity.

#### Creation of Alternate Models

```{r}
#creating model 2
model2_log <- lm(log(totmass) ~ species + sla, data = plant_sub)

#check assumptions for model 2
par(mfrow = c(2,2))
plot(model2_log)

check_normality(model2_log)
check_heteroscedasticity(model2_log)
```

For the second model I chose to look at species and specific area of the youngest leaf of the plant. All assumptions were passed.

```{r}
#creating model 3
model3_log <- lm(log(totmass) ~ num_lvs + feedlevel + amass, data = plant_sub)

#check assumptions for model 3
par(mfrow = c(2,2))
plot(model3_log)

check_normality(model3_log)
check_heteroscedasticity(model3_log)
```

For the third model I decided to look at the grams of ground hymenoptera given to each plant, the number of phyllodes/pitchers produced by each plant, and the mass-based light-saturated photosynthetic rate of youngest leaf. All assumptions were passed.

```{r}
#creating model 4
model4_log <- lm(log(totmass) ~ species + feedlevel, data = plant_sub)

#check assumptions for model 4
par(mfrow = c(2,2))
plot(model4_log)

check_normality(model4_log)
check_heteroscedasticity(model4_log)
```

For the fourth and final model, I looked at just species and the grams of ground hymenoptera given to each plant. All assumptions were passed.

## Results
